{% extends "base.html" %}

{% block title %}Practice Session - LeetCode SRS{% endblock %}

{% block content %}
<div class="session-container">
    <div class="session-header">
        <h1>Practice Session</h1>
        <div class="session-info">
            <div class="session-progress">
                <span id="time-remaining">{{ "%02d:%02d"|format(((session.get_remaining_seconds() or 2700)//60), ((session.get_remaining_seconds() or 2700)%60)) }}</span>
                <span class="progress-label">remaining</span>
            </div>
            <div class="session-stats">
                <span id="problems-completed">{{ session.problems_reviewed }}</span>
                <span class="stats-label">problems completed</span>
            </div>
            <div class="session-duration">
                <span id="session-duration">{{ session.max_duration_minutes or 45 }}</span>
                <span class="duration-label">min session</span>
            </div>
        </div>
    </div>

    <div class="session-content" id="session-content">
        {% if problem %}
            <div class="problem-card" data-problem-id="{{ problem.id }}">
                <div class="problem-header">
                    <h2>{{ problem.title or problem.slug.replace('-', ' ').title() }}</h2>
                    <div class="problem-meta">
                        {% if problem.number %}
                            <span class="problem-number">#{{ problem.number }}</span>
                        {% endif %}
                        {% if problem.difficulty %}
                            <span class="difficulty {{ problem.difficulty.lower() }}">{{ problem.difficulty }}</span>
                        {% endif %}
                    </div>
                </div>

                <div class="problem-link-section">
                    <a href="{{ problem.url }}" target="_blank" class="problem-link" id="problem-link">
                        Open Problem in LeetCode
                        <span class="external-icon">‚Üó</span>
                    </a>
                </div>

                <div class="rating-section">
                    <h3>How did you do?</h3>
                    <div class="rating-buttons">
                        <button class="rating-btn rating-0" data-rating="0" data-key="0">
                            <span class="rating-emoji">üòµ</span>
                            <span class="rating-label">Failed</span>
                            <span class="rating-shortcut">0</span>
                        </button>
                        <button class="rating-btn rating-1" data-rating="1" data-key="1">
                            <span class="rating-emoji">üìñ</span>
                            <span class="rating-label">Solution</span>
                            <span class="rating-shortcut">1</span>
                        </button>
                        <button class="rating-btn rating-2" data-rating="2" data-key="2">
                            <span class="rating-emoji">‚ùå</span>
                            <span class="rating-label">Errors</span>
                            <span class="rating-shortcut">2</span>
                        </button>
                        <button class="rating-btn rating-3" data-rating="3" data-key="3">
                            <span class="rating-emoji">üêõ</span>
                            <span class="rating-label">Debug</span>
                            <span class="rating-shortcut">3</span>
                        </button>
                        <button class="rating-btn rating-4" data-rating="4" data-key="4">
                            <span class="rating-emoji">‚úÖ</span>
                            <span class="rating-label">Solved</span>
                            <span class="rating-shortcut">4</span>
                        </button>
                        <button class="rating-btn rating-5" data-rating="5" data-key="5">
                            <span class="rating-emoji">üöÄ</span>
                            <span class="rating-label">Fluent</span>
                            <span class="rating-shortcut">5</span>
                        </button>
                    </div>
                    <p class="rating-hint">Use keyboard shortcuts 0-5 or click the buttons</p>
                </div>

                <div class="session-controls">
                    <button class="btn btn-secondary skip-btn" data-problem-id="{{ problem.id }}">
                        Skip for Now
                    </button>
                    <button class="btn btn-warning pause-btn" onclick="pauseSession()">
                        ‚è∏Ô∏è Pause Session
                    </button>
                    <button class="btn btn-danger abandon-btn" onclick="abandonSession()">
                        üõë End Session
                    </button>
                </div>

                <div class="session-options">
                    <label class="option-toggle">
                        <input type="checkbox" id="auto-open-problems" checked>
                        <span class="option-label">üîó Auto-open next problem in new tab</span>
                    </label>
                </div>
            </div>
        {% endif %}
    </div>

    <div class="session-complete" id="session-complete" style="display: none;">
        <div class="complete-content">
            <div class="complete-icon">üéâ</div>
            <h2>Session Complete!</h2>
            <p>Great job! You've completed all problems in this session.</p>
            <div class="session-summary" id="session-summary">
                <!-- Will be populated by JavaScript -->
            </div>
            <div class="complete-actions">
                <a href="{{ url_for('dashboard') }}" class="btn btn-primary">Back to Dashboard</a>
                <a href="{{ url_for('session_config') }}" class="btn btn-secondary">Start New Session</a>
            </div>
        </div>
    </div>
</div>

<div class="session-progress-bar">
    <div class="progress-fill" id="progress-fill"></div>
    <div class="progress-text" id="progress-text">
        {{ "%.0f"|format((((current_session.total_time_seconds or 0) / ((current_session.max_duration_minutes or 45) * 60)) * 100)) }}% complete
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// Initialize template variables for JavaScript
const TEMPLATE_DATA = {
    problemId: {{ problem.id if problem else 'null' }},
    sessionId: {{ current_session.id if current_session else 'null' }},
    sessionTimeRemaining: {{ current_session.get_remaining_seconds() or 2700 }},
    maxDurationSeconds: {{ (current_session.max_duration_minutes or 45) * 60 }},
    reviewedProblems: {{ current_session.problems_reviewed }}
};
</script>
<script src="{{ url_for('static', filename='session.js') }}"></script>
{% endblock %}