{% extends "base.html" %}

{% block title %}Dashboard - LeetCode SRS{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h1>Dashboard</h1>
        <p class="subtitle">Your LeetCode spaced repetition progress</p>
    </div>

    <div class="stats-grid">
        <div class="stat-card urgent">
            <div class="stat-number">{{ stats.due_now }}</div>
            <div class="stat-label">Due Now</div>
        </div>
        <div class="stat-card warning">
            <div class="stat-number">{{ stats.due_today }}</div>
            <div class="stat-label">Due Today</div>
        </div>
        <div class="stat-card info">
            <div class="stat-number">{{ stats.total_problems }}</div>
            <div class="stat-label">Total Problems</div>
        </div>
        <div class="stat-card success">
            <div class="stat-number">{{ stats.problems_mastered }}</div>
            <div class="stat-label">Mastered</div>
        </div>
    </div>

    <div class="action-section">
        {% if incomplete_session %}
            <div class="resume-session">
                <div class="resume-icon">‚è∏Ô∏è</div>
                <h3>Resume Practice Session</h3>
                <p>You have a {{ incomplete_session.status }} session with {{ incomplete_session.problems_reviewed }} problems reviewed.</p>
                <div class="resume-actions">
                    <a href="{{ url_for('session_config') }}" class="btn btn-primary btn-large">
                        Resume Session
                        <span class="btn-subtitle">Continue where you left off</span>
                    </a>
                    <button onclick="abandonIncompleteSession()" class="btn btn-secondary">
                        Start Fresh
                    </button>
                </div>
            </div>
        {% elif stats.due_now > 0 %}
            <a href="{{ url_for('session_config') }}" class="btn btn-primary btn-large">
                Start Practice Session
                <span class="btn-subtitle">{{ stats.due_now }} problems waiting</span>
            </a>
        {% else %}
            <div class="no-problems">
                <div class="no-problems-icon">üéâ</div>
                <h3>All caught up!</h3>
                <p>No problems due for review right now. Great job!</p>
                <a href="{{ url_for('problems') }}" class="btn btn-secondary">Add More Problems</a>
            </div>
        {% endif %}
    </div>

    <div class="dashboard-sections">
        <div class="section">
            <h2>Quick Stats</h2>
            <div class="quick-stats">
                <div class="quick-stat">
                    <strong>Average Rating:</strong>
                    <span class="rating-display">{{ "%.1f"|format(stats.average_rating) }}/5</span>
                </div>
                <div class="quick-stat">
                    <strong>Total Reviews:</strong>
                    <span>{{ stats.total_reviews }}</span>
                </div>
                <div class="quick-stat">
                    <strong>By Difficulty:</strong>
                    <div class="difficulty-breakdown">
                        <span class="difficulty easy">Easy: {{ stats.by_difficulty.Easy }}</span>
                        <span class="difficulty medium">Medium: {{ stats.by_difficulty.Medium }}</span>
                        <span class="difficulty hard">Hard: {{ stats.by_difficulty.Hard }}</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Recent Sessions</h2>
            {% if recent_sessions %}
                <div class="session-list">
                    {% for session in recent_sessions %}
                        <div class="session-item">
                            <div class="session-info">
                                <div class="session-date">
                                    {{ session.completed_at.strftime('%m/%d %H:%M') }}
                                </div>
                                <div class="session-stats">
                                    {{ session.problems_reviewed }} problems
                                    {% if session.get_duration_minutes() %}
                                        ‚Ä¢ {{ "%.0f"|format(session.get_duration_minutes()) }} min
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="empty-state">No completed sessions yet. Start practicing to see your progress here!</p>
            {% endif %}
        </div>
    </div>

    <div class="quick-add">
        <h3>Quick Add Problem</h3>
        <form action="{{ url_for('add_problem') }}" method="POST" class="quick-add-form">
            <input type="url" name="url" placeholder="Paste LeetCode URL..." class="form-input" required>
            <button type="submit" class="btn btn-secondary">Add</button>
        </form>
        <p class="form-hint">
            Or <a href="{{ url_for('bookmarklet') }}">install the bookmarklet</a> for one-click adding!
        </p>
    </div>
</div>

<script>
function abandonIncompleteSession() {
    if (confirm('Start a fresh session? This will abandon your current session.')) {
        fetch('/session/abandon', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error abandoning session');
        });
    }
}
</script>
{% endblock %}